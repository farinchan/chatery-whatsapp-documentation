---
title: WebSocket Events
group: Advanced
description: Real-time WebSocket events for receiving instant notifications and updates.
priority: 10
---

## Overview

Chatery WhatsApp API provides real-time WebSocket support for receiving instant notifications about messages, connection status, and other events.

**WebSocket URL:** `ws://localhost:3000`

---

## Connection

Connect to the WebSocket server using Socket.IO client:

```javascript
import { io } from 'socket.io-client';

const socket = io('http://localhost:3000');

// Subscribe to a session
socket.emit('subscribe', 'mysession');

// Unsubscribe from a session
socket.emit('unsubscribe', 'mysession');
```

---

## Events

| Event | Description | Payload |
|-------|-------------|--------|
| `qr` | QR code generated | `{ sessionId, qrCode, timestamp }` |
| `connection.update` | Connection status changed | `{ sessionId, status, phoneNumber?, name?, timestamp }` |
| `message` | New message received | `{ sessionId, message, timestamp }` |
| `message.sent` | Message sent confirmation | `{ sessionId, message, timestamp }` |
| `message.update` | Message status update (read, delivered) | `{ sessionId, update, timestamp }` |
| `message.reaction` | Message reaction added | `{ sessionId, reactions, timestamp }` |
| `message.revoke` | Message deleted/revoked | `{ sessionId, key, participant, timestamp }` |
| `chat.update` | Chat updated | `{ sessionId, chats, timestamp }` |
| `chat.upsert` | New chat created | `{ sessionId, chats, timestamp }` |
| `chat.delete` | Chat deleted | `{ sessionId, chatIds, timestamp }` |
| `contact.update` | Contact updated | `{ sessionId, contacts, timestamp }` |
| `presence.update` | Typing, online status | `{ sessionId, presence, timestamp }` |
| `group.participants` | Group members changed | `{ sessionId, update, timestamp }` |
| `group.update` | Group info changed | `{ sessionId, update, timestamp }` |
| `call` | Incoming call | `{ sessionId, call, timestamp }` |
| `labels` | Labels updated (business) | `{ sessionId, labels, timestamp }` |
| `logged.out` | Session logged out | `{ sessionId, message, timestamp }` |

---

## Event Payloads

### Message Event

```javascript
socket.on('message', (data) => {
  console.log('New message:', data);
  // {
  //   sessionId: 'mysession',
  //   type: 'message',
  //   data: {
  //     id: 'message_id',
  //     from: '628123456789@s.whatsapp.net',
  //     to: '628987654321@s.whatsapp.net',
  //     type: 'text',
  //     content: 'Hello World!',
  //     timestamp: 1609459200,
  //     isGroup: false,
  //     pushName: 'John Doe'
  //   }
  // }
});
```

### Connection Update Event

```javascript
socket.on('connection.update', (data) => {
  console.log('Connection update:', data);
  // {
  //   sessionId: 'mysession',
  //   type: 'connection.update',
  //   data: {
  //     status: 'connected', // or 'disconnected', 'qr_ready', etc.
  //     qr: 'base64_qr_code' // only when status is 'qr_ready'
  //   }
  // }
});
```

### Group Update Event

```javascript
socket.on('group.participants.update', (data) => {
  console.log('Group update:', data);
  // {
  //   sessionId: 'mysession',
  //   type: 'group.participants.update',
  //   data: {
  //     groupId: '123456789@g.us',
  //     action: 'add', // or 'remove', 'promote', 'demote'
  //     participants: ['628123456789@s.whatsapp.net']
  //   }
  // }
});
```

---

## Example: Listen for Messages

```javascript
const socket = io('http://localhost:3000');

socket.on('connect', () => {
  console.log('Connected to WebSocket');
  socket.emit('subscribe', 'mysession');
});

socket.on('message', (data) => {
  console.log('New message:', data.message);
  // {
  //   sessionId: 'mysession',
  //   message: {
  //     id: 'ABC123',
  //     from: '628123456789@s.whatsapp.net',
  //     text: 'Hello!',
  //     timestamp: 1234567890,
  //     ...
  //   },
  //   timestamp: '2024-01-15T10:30:00.000Z'
  // }
});

socket.on('qr', (data) => {
  console.log('Scan QR Code:', data.qrCode);
});

socket.on('connection.update', (data) => {
  console.log('Connection status:', data.status);
  if (data.status === 'connected') {
    console.log(`Connected as ${data.name} (${data.phoneNumber})`);
  }
});
```

---

## WebSocket Test Page

For testing and debugging WebSocket events, open the interactive test page in your browser:

```
http://localhost:3000/ws-test
```

This page provides:
- Real-time event viewer
- Event filtering
- Session subscription
- Event details inspection

---

## WebSocket Stats

Get statistics about active WebSocket connections:

```http
GET /api/websocket/stats
```

**Response:**
```json
{
  "success": true,
  "data": {
    "totalConnections": 5,
    "sessionRooms": {
      "mysession": 2,
      "othersession": 1
    }
  }
}
```
