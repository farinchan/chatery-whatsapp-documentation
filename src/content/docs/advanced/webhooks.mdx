---
title: Webhooks
group: Advanced
description: Configure webhooks to receive event notifications on your server.
priority: 9
---

## Overview

Webhooks allow you to receive real-time notifications about WhatsApp events on your own server. You can configure multiple webhook URLs per session, each subscribing to specific events.

---

## Setup Multiple Webhooks

### During Session Creation

```bash
curl -X POST http://localhost:3000/api/whatsapp/sessions/mysession/connect \
  -H "Content-Type: application/json" \
  -H "X-Api-Key: your_api_key" \
  -d '{
    "webhooks": [
      { "url": "https://your-server.com/webhook", "events": ["all"] },
      { "url": "https://backup.com/webhook", "events": ["message"] }
    ]
  }'
```

### Add Webhook to Existing Session

```http
POST /sessions/:sessionId/webhooks
```

**Body:**
```json
{
  "url": "https://new-server.com/webhook",
  "events": ["message", "connection.update"]
}
```

### Remove Webhook

```http
DELETE /sessions/:sessionId/webhooks
```

**Body:**
```json
{
  "url": "https://old-server.com/webhook"
}
```

---

## Webhook Payload

All configured webhook endpoints will receive `POST` requests with this format:

```json
{
  "event": "message",
  "sessionId": "mysession",
  "metadata": {
    "userId": "123",
    "customField": "value"
  },
  "data": {
    "id": "ABC123",
    "from": "628123456789@s.whatsapp.net",
    "text": "Hello!",
    "timestamp": 1234567890
  },
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

---

## Webhook Headers

Each webhook request includes these headers:

| Header | Value |
|--------|-------|
| `Content-Type` | `application/json` |
| `X-Webhook-Source` | `chatery-whatsapp-api` |
| `X-Session-Id` | Session ID |
| `X-Webhook-Event` | Event name |

---

## Available Webhook Events

| Event | Description |
|-------|-------------|
| `connection.update` | Connection status changed (connected, disconnected) |
| `message` | New message received |
| `message.sent` | Message sent confirmation |
| `message.update` | Message status update (read, delivered) |
| `message.reaction` | Message reaction added |
| `message.revoke` | Message deleted/revoked |
| `chat.update` | Chat updated |
| `chat.upsert` | New chat created |
| `chat.delete` | Chat deleted |
| `contact.update` | Contact updated |
| `presence.update` | Typing, online status |
| `group.participants` | Group members changed |
| `group.update` | Group info changed |
| `call` | Incoming call |
| `labels` | Labels updated (business) |
| `logged.out` | Session logged out |
| `all` | Subscribe to all events |

---

## Webhook Event Payloads

### Message Event

```json
{
  "sessionId": "mysession",
  "type": "message",
  "timestamp": 1609459200,
  "data": {
    "id": "ABCD1234567890",
    "from": "628123456789@s.whatsapp.net",
    "to": "628987654321@s.whatsapp.net",
    "type": "text",
    "content": "Hello World!",
    "pushName": "John Doe",
    "isGroup": false,
    "groupId": null
  }
}
```

### Connection Update Event

```json
{
  "sessionId": "mysession",
  "type": "connection.update",
  "timestamp": 1609459200,
  "data": {
    "status": "connected",
    "phoneNumber": "628123456789",
    "name": "John Doe"
  }
}
```

### Group Participants Update

```json
{
  "sessionId": "mysession",
  "type": "group.participants.update",
  "timestamp": 1609459200,
  "data": {
    "groupId": "123456789@g.us",
    "action": "add",
    "participants": ["628111222333@s.whatsapp.net"],
    "by": "628123456789@s.whatsapp.net"
  }
}
```

---

## Webhook Best Practices

1. **Respond Quickly** - Return a 2xx status code within 5 seconds
2. **Handle Retries** - Implement idempotency for duplicate events
3. **Use HTTPS** - Always use secure endpoints in production
4. **Queue Processing** - Process events asynchronously if heavy processing is needed

---

## Example Webhook Server

### Node.js/Express

```javascript
const express = require('express');
const app = express();

app.use(express.json());

app.post('/webhook', (req, res) => {
  const { event, sessionId, metadata, data, timestamp } = req.body;
  
  console.log(`[${sessionId}] Event: ${event} at ${timestamp}`);
  
  switch (event) {
    case 'message':
      console.log(`New message from ${data.from}: ${data.text}`);
      break;
    case 'connection.update':
      console.log(`Connection status: ${data.status}`);
      break;
    default:
      console.log('Event data:', data);
  }
  
  // Always respond with 200 OK
  res.status(200).json({ received: true });
});

app.listen(3001, () => {
  console.log('Webhook server running on port 3001');
});
```

### Python/Flask

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/webhook', methods=['POST'])
def webhook():
    payload = request.json
    
    event = payload.get('event')
    session_id = payload.get('sessionId')
    metadata = payload.get('metadata')
    data = payload.get('data')
    
    print(f"[{session_id}] Event: {event}")
    
    if event == 'message':
        print(f"New message from {data['from']}: {data.get('text', '')}")
    elif event == 'connection.update':
        print(f"Connection status: {data['status']}")
    
    return jsonify({'received': True}), 200

if __name__ == '__main__':
    app.run(port=3001)
```
